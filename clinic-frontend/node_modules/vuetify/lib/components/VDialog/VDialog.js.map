{"version":3,"file":"VDialog.js","names":["VDialogTransition","VDefaultsProvider","VOverlay","makeVOverlayProps","forwardRefs","useProxiedModel","useScopeId","mergeProps","nextTick","onBeforeUnmount","ref","watch","focusableChildren","genericComponent","IN_BROWSER","propsFactory","useRender","makeVDialogProps","fullscreen","Boolean","retainFocus","type","default","scrollable","origin","scrollStrategy","transition","component","zIndex","VDialog","name","props","emits","value","afterEnter","afterLeave","setup","_ref","emit","slots","isActive","scopeId","overlay","onFocusin","e","before","relatedTarget","after","target","contentEl","globalTop","document","includes","contains","focusable","focus","onKeydown","key","length","firstElement","lastElement","active","activeElement","shiftKey","preventDefault","removeEventListener","val","addEventListener","once","immediate","onAfterEnter","scrim","preventScroll","onAfterLeave","activatorEl","overlayProps","filterProps","activatorProps","contentProps","tabindex","_createVNode","_mergeProps","class","style","$event","height","undefined","width","maxHeight","maxWidth","activator","_len","arguments","args","Array","_key"],"sources":["../../../src/components/VDialog/VDialog.tsx"],"sourcesContent":["// Styles\nimport './VDialog.sass'\n\n// Components\nimport { VDialogTransition } from '@/components/transitions'\nimport { VDefaultsProvider } from '@/components/VDefaultsProvider'\nimport { VOverlay } from '@/components/VOverlay'\nimport { makeVOverlayProps } from '@/components/VOverlay/VOverlay'\n\n// Composables\nimport { forwardRefs } from '@/composables/forwardRefs'\nimport { useProxiedModel } from '@/composables/proxiedModel'\nimport { useScopeId } from '@/composables/scopeId'\n\n// Utilities\nimport { mergeProps, nextTick, onBeforeUnmount, ref, watch } from 'vue'\nimport { focusableChildren, genericComponent, IN_BROWSER, propsFactory, useRender } from '@/util'\n\n// Types\nimport type { OverlaySlots } from '@/components/VOverlay/VOverlay'\n\nexport const makeVDialogProps = propsFactory({\n  fullscreen: Boolean,\n  retainFocus: {\n    type: Boolean,\n    default: true,\n  },\n  scrollable: Boolean,\n\n  ...makeVOverlayProps({\n    origin: 'center center' as const,\n    scrollStrategy: 'block' as const,\n    transition: { component: VDialogTransition },\n    zIndex: 2400,\n  }),\n}, 'VDialog')\n\nexport const VDialog = genericComponent<OverlaySlots>()({\n  name: 'VDialog',\n\n  props: makeVDialogProps(),\n\n  emits: {\n    'update:modelValue': (value: boolean) => true,\n    afterEnter: () => true,\n    afterLeave: () => true,\n  },\n\n  setup (props, { emit, slots }) {\n    const isActive = useProxiedModel(props, 'modelValue')\n    const { scopeId } = useScopeId()\n\n    const overlay = ref<VOverlay>()\n    async function onFocusin (e: FocusEvent) {\n      const before = e.relatedTarget as HTMLElement | null\n      const after = e.target as HTMLElement | null\n\n      await nextTick()\n\n      if (\n        isActive.value &&\n        before !== after &&\n        overlay.value?.contentEl &&\n        // We're the topmost dialog\n        overlay.value?.globalTop &&\n        // It isn't the document or the dialog body\n        ![document, overlay.value.contentEl].includes(after!) &&\n        // It isn't inside the dialog body\n        !overlay.value.contentEl.contains(after)\n      ) {\n        const focusable = focusableChildren(overlay.value.contentEl)\n        focusable[0]?.focus()\n      }\n    }\n\n    function onKeydown (e: KeyboardEvent) {\n      if (e.key !== 'Tab' || !overlay.value?.contentEl) return\n\n      const focusable = focusableChildren(overlay.value.contentEl)\n      if (!focusable.length) return\n\n      const firstElement = focusable[0]\n      const lastElement = focusable[focusable.length - 1]\n      const active = document.activeElement as HTMLElement | null\n\n      if (e.shiftKey && active === firstElement) {\n        e.preventDefault()\n        lastElement.focus()\n      } else if (!e.shiftKey && active === lastElement) {\n        e.preventDefault()\n        firstElement.focus()\n      }\n    }\n\n    onBeforeUnmount(() => {\n      document.removeEventListener('focusin', onFocusin)\n      document.removeEventListener('keydown', onKeydown)\n    })\n\n    if (IN_BROWSER) {\n      watch(() => isActive.value && props.retainFocus, val => {\n        if (val) {\n          document.addEventListener('focusin', onFocusin, { once: true })\n          document.addEventListener('keydown', onKeydown)\n        } else {\n          document.removeEventListener('focusin', onFocusin)\n          document.removeEventListener('keydown', onKeydown)\n        }\n      }, { immediate: true })\n    }\n\n    function onAfterEnter () {\n      emit('afterEnter')\n      if (\n        (props.scrim || props.retainFocus) &&\n        overlay.value?.contentEl &&\n        !overlay.value.contentEl.contains(document.activeElement)\n      ) {\n        overlay.value.contentEl.focus({ preventScroll: true })\n      }\n    }\n\n    function onAfterLeave () {\n      emit('afterLeave')\n    }\n\n    watch(isActive, async val => {\n      if (!val) {\n        await nextTick()\n        overlay.value!.activatorEl?.focus({ preventScroll: true })\n      }\n    })\n\n    useRender(() => {\n      const overlayProps = VOverlay.filterProps(props)\n      const activatorProps = mergeProps({\n        'aria-haspopup': 'dialog',\n      }, props.activatorProps)\n      const contentProps = mergeProps({\n        tabindex: -1,\n      }, props.contentProps)\n\n      return (\n        <VOverlay\n          ref={ overlay }\n          class={[\n            'v-dialog',\n            {\n              'v-dialog--fullscreen': props.fullscreen,\n              'v-dialog--scrollable': props.scrollable,\n            },\n            props.class,\n          ]}\n          style={ props.style }\n          { ...overlayProps }\n          v-model={ isActive.value }\n          aria-modal=\"true\"\n          activatorProps={ activatorProps }\n          contentProps={ contentProps }\n          height={ !props.fullscreen ? props.height : undefined }\n          width={ !props.fullscreen ? props.width : undefined }\n          maxHeight={ !props.fullscreen ? props.maxHeight : undefined }\n          maxWidth={ !props.fullscreen ? props.maxWidth : undefined }\n          role=\"dialog\"\n          onAfterEnter={ onAfterEnter }\n          onAfterLeave={ onAfterLeave }\n          { ...scopeId }\n        >\n          {{\n            activator: slots.activator,\n            default: (...args) => (\n              <VDefaultsProvider root=\"VDialog\">\n                { slots.default?.(...args) }\n              </VDefaultsProvider>\n            ),\n          }}\n        </VOverlay>\n      )\n    })\n\n    return forwardRefs({}, overlay)\n  },\n})\n\nexport type VDialog = InstanceType<typeof VDialog>\n"],"mappings":";AAAA;AACA;;AAEA;AAAA,SACSA,iBAAiB;AAAA,SACjBC,iBAAiB;AAAA,SACjBC,QAAQ;AAAA,SACRC,iBAAiB,mCAE1B;AAAA,SACSC,WAAW;AAAA,SACXC,eAAe;AAAA,SACfC,UAAU,wCAEnB;AACA,SAASC,UAAU,EAAEC,QAAQ,EAAEC,eAAe,EAAEC,GAAG,EAAEC,KAAK,QAAQ,KAAK;AAAA,SAC9DC,iBAAiB,EAAEC,gBAAgB,EAAEC,UAAU,EAAEC,YAAY,EAAEC,SAAS,+BAEjF;AAGA,OAAO,MAAMC,gBAAgB,GAAGF,YAAY,CAAC;EAC3CG,UAAU,EAAEC,OAAO;EACnBC,WAAW,EAAE;IACXC,IAAI,EAAEF,OAAO;IACbG,OAAO,EAAE;EACX,CAAC;EACDC,UAAU,EAAEJ,OAAO;EAEnB,GAAGhB,iBAAiB,CAAC;IACnBqB,MAAM,EAAE,eAAwB;IAChCC,cAAc,EAAE,OAAgB;IAChCC,UAAU,EAAE;MAAEC,SAAS,EAAE3B;IAAkB,CAAC;IAC5C4B,MAAM,EAAE;EACV,CAAC;AACH,CAAC,EAAE,SAAS,CAAC;AAEb,OAAO,MAAMC,OAAO,GAAGhB,gBAAgB,CAAe,CAAC,CAAC;EACtDiB,IAAI,EAAE,SAAS;EAEfC,KAAK,EAAEd,gBAAgB,CAAC,CAAC;EAEzBe,KAAK,EAAE;IACL,mBAAmB,EAAGC,KAAc,IAAK,IAAI;IAC7CC,UAAU,EAAEA,CAAA,KAAM,IAAI;IACtBC,UAAU,EAAEA,CAAA,KAAM;EACpB,CAAC;EAEDC,KAAKA,CAAEL,KAAK,EAAAM,IAAA,EAAmB;IAAA,IAAjB;MAAEC,IAAI;MAAEC;IAAM,CAAC,GAAAF,IAAA;IAC3B,MAAMG,QAAQ,GAAGnC,eAAe,CAAC0B,KAAK,EAAE,YAAY,CAAC;IACrD,MAAM;MAAEU;IAAQ,CAAC,GAAGnC,UAAU,CAAC,CAAC;IAEhC,MAAMoC,OAAO,GAAGhC,GAAG,CAAW,CAAC;IAC/B,eAAeiC,SAASA,CAAEC,CAAa,EAAE;MACvC,MAAMC,MAAM,GAAGD,CAAC,CAACE,aAAmC;MACpD,MAAMC,KAAK,GAAGH,CAAC,CAACI,MAA4B;MAE5C,MAAMxC,QAAQ,CAAC,CAAC;MAEhB,IACEgC,QAAQ,CAACP,KAAK,IACdY,MAAM,KAAKE,KAAK,IAChBL,OAAO,CAACT,KAAK,EAAEgB,SAAS;MACxB;MACAP,OAAO,CAACT,KAAK,EAAEiB,SAAS;MACxB;MACA,CAAC,CAACC,QAAQ,EAAET,OAAO,CAACT,KAAK,CAACgB,SAAS,CAAC,CAACG,QAAQ,CAACL,KAAM,CAAC;MACrD;MACA,CAACL,OAAO,CAACT,KAAK,CAACgB,SAAS,CAACI,QAAQ,CAACN,KAAK,CAAC,EACxC;QACA,MAAMO,SAAS,GAAG1C,iBAAiB,CAAC8B,OAAO,CAACT,KAAK,CAACgB,SAAS,CAAC;QAC5DK,SAAS,CAAC,CAAC,CAAC,EAAEC,KAAK,CAAC,CAAC;MACvB;IACF;IAEA,SAASC,SAASA,CAAEZ,CAAgB,EAAE;MACpC,IAAIA,CAAC,CAACa,GAAG,KAAK,KAAK,IAAI,CAACf,OAAO,CAACT,KAAK,EAAEgB,SAAS,EAAE;MAElD,MAAMK,SAAS,GAAG1C,iBAAiB,CAAC8B,OAAO,CAACT,KAAK,CAACgB,SAAS,CAAC;MAC5D,IAAI,CAACK,SAAS,CAACI,MAAM,EAAE;MAEvB,MAAMC,YAAY,GAAGL,SAAS,CAAC,CAAC,CAAC;MACjC,MAAMM,WAAW,GAAGN,SAAS,CAACA,SAAS,CAACI,MAAM,GAAG,CAAC,CAAC;MACnD,MAAMG,MAAM,GAAGV,QAAQ,CAACW,aAAmC;MAE3D,IAAIlB,CAAC,CAACmB,QAAQ,IAAIF,MAAM,KAAKF,YAAY,EAAE;QACzCf,CAAC,CAACoB,cAAc,CAAC,CAAC;QAClBJ,WAAW,CAACL,KAAK,CAAC,CAAC;MACrB,CAAC,MAAM,IAAI,CAACX,CAAC,CAACmB,QAAQ,IAAIF,MAAM,KAAKD,WAAW,EAAE;QAChDhB,CAAC,CAACoB,cAAc,CAAC,CAAC;QAClBL,YAAY,CAACJ,KAAK,CAAC,CAAC;MACtB;IACF;IAEA9C,eAAe,CAAC,MAAM;MACpB0C,QAAQ,CAACc,mBAAmB,CAAC,SAAS,EAAEtB,SAAS,CAAC;MAClDQ,QAAQ,CAACc,mBAAmB,CAAC,SAAS,EAAET,SAAS,CAAC;IACpD,CAAC,CAAC;IAEF,IAAI1C,UAAU,EAAE;MACdH,KAAK,CAAC,MAAM6B,QAAQ,CAACP,KAAK,IAAIF,KAAK,CAACX,WAAW,EAAE8C,GAAG,IAAI;QACtD,IAAIA,GAAG,EAAE;UACPf,QAAQ,CAACgB,gBAAgB,CAAC,SAAS,EAAExB,SAAS,EAAE;YAAEyB,IAAI,EAAE;UAAK,CAAC,CAAC;UAC/DjB,QAAQ,CAACgB,gBAAgB,CAAC,SAAS,EAAEX,SAAS,CAAC;QACjD,CAAC,MAAM;UACLL,QAAQ,CAACc,mBAAmB,CAAC,SAAS,EAAEtB,SAAS,CAAC;UAClDQ,QAAQ,CAACc,mBAAmB,CAAC,SAAS,EAAET,SAAS,CAAC;QACpD;MACF,CAAC,EAAE;QAAEa,SAAS,EAAE;MAAK,CAAC,CAAC;IACzB;IAEA,SAASC,YAAYA,CAAA,EAAI;MACvBhC,IAAI,CAAC,YAAY,CAAC;MAClB,IACE,CAACP,KAAK,CAACwC,KAAK,IAAIxC,KAAK,CAACX,WAAW,KACjCsB,OAAO,CAACT,KAAK,EAAEgB,SAAS,IACxB,CAACP,OAAO,CAACT,KAAK,CAACgB,SAAS,CAACI,QAAQ,CAACF,QAAQ,CAACW,aAAa,CAAC,EACzD;QACApB,OAAO,CAACT,KAAK,CAACgB,SAAS,CAACM,KAAK,CAAC;UAAEiB,aAAa,EAAE;QAAK,CAAC,CAAC;MACxD;IACF;IAEA,SAASC,YAAYA,CAAA,EAAI;MACvBnC,IAAI,CAAC,YAAY,CAAC;IACpB;IAEA3B,KAAK,CAAC6B,QAAQ,EAAE,MAAM0B,GAAG,IAAI;MAC3B,IAAI,CAACA,GAAG,EAAE;QACR,MAAM1D,QAAQ,CAAC,CAAC;QAChBkC,OAAO,CAACT,KAAK,CAAEyC,WAAW,EAAEnB,KAAK,CAAC;UAAEiB,aAAa,EAAE;QAAK,CAAC,CAAC;MAC5D;IACF,CAAC,CAAC;IAEFxD,SAAS,CAAC,MAAM;MACd,MAAM2D,YAAY,GAAGzE,QAAQ,CAAC0E,WAAW,CAAC7C,KAAK,CAAC;MAChD,MAAM8C,cAAc,GAAGtE,UAAU,CAAC;QAChC,eAAe,EAAE;MACnB,CAAC,EAAEwB,KAAK,CAAC8C,cAAc,CAAC;MACxB,MAAMC,YAAY,GAAGvE,UAAU,CAAC;QAC9BwE,QAAQ,EAAE,CAAC;MACb,CAAC,EAAEhD,KAAK,CAAC+C,YAAY,CAAC;MAEtB,OAAAE,YAAA,CAAA9E,QAAA,EAAA+E,WAAA;QAAA,OAEUvC,OAAO;QAAA,SACN,CACL,UAAU,EACV;UACE,sBAAsB,EAAEX,KAAK,CAACb,UAAU;UACxC,sBAAsB,EAAEa,KAAK,CAACR;QAChC,CAAC,EACDQ,KAAK,CAACmD,KAAK,CACZ;QAAA,SACOnD,KAAK,CAACoD;MAAK,GACdR,YAAY;QAAA,cACPnC,QAAQ,CAACP,KAAK;QAAA,uBAAAmD,MAAA,IAAd5C,QAAQ,CAACP,KAAK,GAAAmD,MAAA;QAAA;QAAA,kBAEPP,cAAc;QAAA,gBAChBC,YAAY;QAAA,UAClB,CAAC/C,KAAK,CAACb,UAAU,GAAGa,KAAK,CAACsD,MAAM,GAAGC,SAAS;QAAA,SAC7C,CAACvD,KAAK,CAACb,UAAU,GAAGa,KAAK,CAACwD,KAAK,GAAGD,SAAS;QAAA,aACvC,CAACvD,KAAK,CAACb,UAAU,GAAGa,KAAK,CAACyD,SAAS,GAAGF,SAAS;QAAA,YAChD,CAACvD,KAAK,CAACb,UAAU,GAAGa,KAAK,CAAC0D,QAAQ,GAAGH,SAAS;QAAA;QAAA,gBAE1ChB,YAAY;QAAA,gBACZG;MAAY,GACtBhC,OAAO;QAGViD,SAAS,EAAEnD,KAAK,CAACmD,SAAS;QAC1BpE,OAAO,EAAE,SAAAA,CAAA;UAAA,SAAAqE,IAAA,GAAAC,SAAA,CAAAlC,MAAA,EAAImC,IAAI,OAAAC,KAAA,CAAAH,IAAA,GAAAI,IAAA,MAAAA,IAAA,GAAAJ,IAAA,EAAAI,IAAA;YAAJF,IAAI,CAAAE,IAAA,IAAAH,SAAA,CAAAG,IAAA;UAAA;UAAA,OAAAf,YAAA,CAAA/E,iBAAA;YAAA;UAAA;YAAAqB,OAAA,EAAAA,CAAA,MAEXiB,KAAK,CAACjB,OAAO,GAAG,GAAGuE,IAAI,CAAC;UAAA;QAAA;MAE7B;IAIT,CAAC,CAAC;IAEF,OAAOzF,WAAW,CAAC,CAAC,CAAC,EAAEsC,OAAO,CAAC;EACjC;AACF,CAAC,CAAC","ignoreList":[]}