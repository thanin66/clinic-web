{"version":3,"file":"box.js","names":["Box","constructor","args","pageScale","document","body","currentCSSZoom","factor","DOMRect","x","y","width","height","top","bottom","left","right","getOverflow","a","b","before","Math","max","after","getTargetBox","target","Array","isArray","getBoundingClientRect","getElementBox","el","documentElement","visualViewport","clientWidth","clientHeight","scale","offsetLeft","offsetTop","rect"],"sources":["../../src/util/box.ts"],"sourcesContent":["export class Box {\n  x: number\n  y: number\n  width: number\n  height: number\n\n  constructor (args: DOMRect | {\n    x: number\n    y: number\n    width: number\n    height: number\n  }) {\n    const pageScale = document.body.currentCSSZoom ?? 1\n    const factor = args instanceof DOMRect ? 1 + (1 - pageScale) / pageScale : 1\n\n    const { x, y, width, height } = args\n\n    this.x = x * factor\n    this.y = y * factor\n    this.width = width * factor\n    this.height = height * factor\n  }\n\n  get top () { return this.y }\n  get bottom () { return this.y + this.height }\n  get left () { return this.x }\n  get right () { return this.x + this.width }\n}\n\nexport function getOverflow (a: Box, b: Box) {\n  return {\n    x: {\n      before: Math.max(0, b.left - a.left),\n      after: Math.max(0, a.right - b.right),\n    },\n    y: {\n      before: Math.max(0, b.top - a.top),\n      after: Math.max(0, a.bottom - b.bottom),\n    },\n  }\n}\n\nexport function getTargetBox (target: HTMLElement | [x: number, y: number]): Box {\n  if (Array.isArray(target)) {\n    const pageScale = document.body.currentCSSZoom ?? 1\n    const factor = 1 + (1 - pageScale) / pageScale\n\n    return new Box({\n      x: target[0] * factor,\n      y: target[1] * factor,\n      width: 0 * factor,\n      height: 0 * factor,\n    })\n  } else {\n    return new Box(target.getBoundingClientRect())\n  }\n}\n\nexport function getElementBox (el: HTMLElement) {\n  if (el === document.documentElement) {\n    if (!visualViewport) {\n      return new Box({\n        x: 0,\n        y: 0,\n        width: document.documentElement.clientWidth,\n        height: document.documentElement.clientHeight,\n      })\n    } else {\n      const pageScale = document.body.currentCSSZoom ?? 1\n      return new Box({\n        x: visualViewport.scale > 1 ? 0 : visualViewport.offsetLeft,\n        y: visualViewport.scale > 1 ? 0 : visualViewport.offsetTop,\n        width: visualViewport.width * visualViewport.scale / pageScale,\n        height: visualViewport.height * visualViewport.scale / pageScale,\n      })\n    }\n  } else {\n    const rect = el.getBoundingClientRect()\n    return new Box({\n      x: rect.x,\n      y: rect.y,\n      width: el.clientWidth,\n      height: el.clientHeight,\n    })\n  }\n}\n"],"mappings":"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","ignoreList":[]}